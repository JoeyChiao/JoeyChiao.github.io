<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>å–®å­—å¡ â€” æ¨™è¨˜èˆ‡æ´—ç‰ŒåŠŸèƒ½ä¿®æ­£ç‰ˆ</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{--bg:#071322;--card:#0b1220;--accent:#7dd3fc;--muted:#94a3b8}
  *{box-sizing:border-box}
  body{margin:0;min-height:100vh;background:linear-gradient(180deg,#071026 0%, #071322 60%);color:#e6eef8;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;display:flex;align-items:center;justify-content:center;padding:24px}
  .wrap{width:100%;max-width:820px}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:18px;flex-wrap:wrap}
  h1{font-size:18px;margin:0;font-weight:700}
  .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .btn{appearance:none;border:0;padding:8px 12px;border-radius:10px;background:rgba(255,255,255,0.03);color:inherit;cursor:pointer;font-weight:600;transition: background-color 0.3s ease;}
  .btn.primary{background:linear-gradient(90deg, rgba(125,211,252,0.12), rgba(99,102,241,0.08));border:1px solid rgba(125,211,252,0.12)}
  .btn:hover {
    background: rgba(125, 211, 252, 0.2);
    color: #072033;
  }
  .toggle{display:inline-flex;background:rgba(255,255,255,0.02);padding:6px;border-radius:999px}
  .toggle button{background:transparent;border:0;color:var(--muted);padding:6px 10px;border-radius:8px;cursor:pointer;transition: background-color 0.3s ease;}
  .toggle button.active{background:var(--accent);color:#072033}
  .toggle button:hover:not(.active) {background: rgba(125,211,252,0.1);}
  input[type="file"]{display:none}

  /* card area */
  .stage{display:flex;gap:20px;align-items:flex-start;flex-wrap:wrap}
  .card-wrap{perspective:1200px;width:100%;max-width:560px;flex-grow:1;min-width:320px;position:relative}
  .card{width:100%;min-height:340px;border-radius:16px;padding:28px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(125,211,252,0.06);box-shadow:0 8px 30px rgba(2,6,23,0.6);position:relative;transform-style:preserve-3d;transition:transform .6s;cursor:pointer}
  .card.is-flipped{transform:rotateY(180deg)}
  .card-face{position:absolute;inset:0;backface-visibility:hidden;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;padding:28px}
  .front{z-index:2}
  .back{transform:rotateY(180deg)}

  /* layout inside card */
  .word-large{font-size:44px;font-weight:800;letter-spacing:-0.02em;text-align:center;margin-top:10px}
  .ipa-pos{margin-top:12px;display:flex;gap:10px;align-items:center;color:var(--accent)}
  .ipa{font-size:15px;padding:6px 10px;border-radius:999px;background:rgba(125,211,252,0.06)}
  .pos{font-size:13px;background:rgba(125,211,252,0.08);color:#062033;padding:6px 8px;border-radius:8px;font-weight:700}
  .example{margin-top:20px;font-size:16px;line-height:1.6;color:#eaf6ff;text-align:center;word-break:break-word}

  /* star button */
  .star{position:absolute;right:18px;top:12px;background:transparent;border:0;color:var(--muted);font-size:28px;cursor:pointer;user-select:none;z-index:10}
  .star.active{color:#ffd86b}
  
  /* side controls */
  aside.side{width:220px;flex-shrink:0}
  .nav{display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap}
  .meta{color:var(--muted);font-size:13px;white-space:nowrap}

  @media (max-width:740px){
    .stage{flex-direction:column;align-items:center}
    aside.side{width:100%;max-width:560px;margin-top:18px;text-align:center}
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>å–®å­—å¡ â€” é»å¡ç‰‡ç¿»é¢ / æ¨™è¨˜æ˜Ÿè™Ÿ</h1>
        <div class="meta" style="font-size:13px;color:var(--muted)">æŒ‰ç©ºç™½éµç¿»é ã€â† â†’ åˆ‡æ›å–®å­—</div>
      </div>
      <div class="controls">
        <label class="btn" for="fileInput" title="åŒ¯å…¥ txt æª”æ¡ˆ">ğŸ“ åŒ¯å…¥ txt</label>
        <button class="btn" id="shuffleBtn" title="æ´—ç‰Œæ‰“äº‚å–®å­—é †åº">ğŸ”€ æ´—ç‰Œ</button>
        <div class="toggle" role="tablist" aria-label="ç¯©é¸å¡ç‰‡">
          <button id="showAll" class="active" aria-selected="true" role="tab">å…¨éƒ¨</button>
          <button id="showStar" aria-selected="false" role="tab">æ¨™è¨˜</button>
        </div>
      </div>
      <input type="file" id="fileInput" accept=".txt" />
    </header>

    <main class="stage">
      <div class="card-wrap">
        <button class="star" id="starBtn" title="æ¨™è¨˜/å–æ¶ˆæ¨™è¨˜">â˜†</button>
        <div class="card" id="card" tabindex="0" aria-live="polite" aria-atomic="true" role="region">
          <!-- front -->
          <div class="card-face front">
            <div class="word-large" id="wordTop">rehearsal</div>
            <div class="ipa-pos">
              <div class="ipa" id="ipa">[ rÉªË‹hÉs! ]</div>
              <div class="pos" id="pos">åè©</div>
            </div>
            <div class="example" id="engExample">Do you think the university could help us rent a rehearsal space in a commercial dance studio in town, given the situation?</div>
          </div>

          <!-- back -->
          <div class="card-face back">
            <div class="word-large" id="wordCn">æ’ç·´, æ’æ¼”, å½©æ’</div>
            <div class="ipa-pos" style="margin-top:14px;">
              <div class="pos" id="posCn">åè©</div>
            </div>
            <div class="example" id="cnExample">ä½ è¦ºå¾—è€ƒæ…®åˆ°é€™ç¨®ç‹€æ³ï¼Œå­¸æ ¡æœƒå¹«æˆ‘å€‘åœ¨åŸå¸‚ä¸­çš„å•†æ¥­èˆè¹ˆå®¤ï¼Œç§Ÿå€Ÿä¸€å€‹æ’ç·´çš„å ´åœ°ã€‚</div>
          </div>
        </div>
      </div>

      <aside class="side">
        <div class="nav">
          <button class="btn" id="prev">â† ä¸Šä¸€å¼µ</button>
          <button class="btn primary" id="next">ä¸‹ä¸€å¼µ â†’</button>
        </div>
        <div class="meta" id="meta">Card 1 / 2</div>
      </aside>
    </main>
  </div>

<script>
const STORAGE_KEY_STAR = 'vocab_starred_v1';
const STORAGE_KEY_CARDS = 'vocab_cards_data_v1';

let starred = new Set(JSON.parse(localStorage.getItem(STORAGE_KEY_STAR) || '[]'));
let idx = 0;
let filter = 'all'; // 'all' or 'star'

// é è¨­å…§å»ºå­—å¡è³‡æ–™
let cards = [
  {word:'rehearsal', ipa:'[ rÉªË‹hÉs! ]', pos:'åè©', meaning:'æ’ç·´, æ’æ¼”, å½©æ’', sentence:'Do you think the university could help us rent a rehearsal space in a commercial dance studio in town, given the situation?', sentence_cn:'ä½ è¦ºå¾—è€ƒæ…®åˆ°é€™ç¨®ç‹€æ³ï¼Œå­¸æ ¡æœƒå¹«æˆ‘å€‘åœ¨åŸå¸‚ä¸­çš„å•†æ¥­èˆè¹ˆå®¤ï¼Œç§Ÿå€Ÿä¸€å€‹æ’ç·´çš„å ´åœ°ã€‚'},
  {word:'scramble', ipa:'[ ËˆskrÃ¦mbÉ™l ]', pos:'å‹•è©', meaning:'æ¶, æŠ“', sentence:'There are at least a dozen dance and drama groups on campus, and they are all scrambling for rehearsal space right now.', sentence_cn:'åœ¨æ ¡åœ’è£¡è‡³å°‘æœ‰(ä¸€æ‰“)åäºŒå€‹èˆè¹ˆå’Œæˆ²åŠ‡åœ˜é«”ï¼Œä»–å€‘ç›®å‰éƒ½åœ¨çˆ­æ¶æ’ç·´ç©ºé–“ã€‚'}
];

// å„²å­˜æ˜Ÿè™Ÿ
function saveStars() {
  localStorage.setItem(STORAGE_KEY_STAR, JSON.stringify(Array.from(starred)));
}

// å„²å­˜ç›®å‰å¡ç‰‡è³‡æ–™
function saveCards() {
  localStorage.setItem(STORAGE_KEY_CARDS, JSON.stringify(cards));
}

// å¾ localStorage è¼‰å…¥å¡ç‰‡è³‡æ–™ï¼ˆå¦‚æœæœ‰ï¼‰
function loadCards() {
  const saved = localStorage.getItem(STORAGE_KEY_CARDS);
  if (saved) {
    try {
      const parsed = JSON.parse(saved);
      if (Array.isArray(parsed) && parsed.length > 0) {
        cards = parsed;
      }
    } catch {
      // ç„¡è¦–éŒ¯èª¤
    }
  }
}

const cardEl = document.getElementById('card');
const wordTop = document.getElementById('wordTop');
const ipaEl = document.getElementById('ipa');
const posEl = document.getElementById('pos');
const engExample = document.getElementById('engExample');
const wordCn = document.getElementById('wordCn');
const posCn = document.getElementById('posCn');
const cnExample = document.getElementById('cnExample');
const metaEl = document.getElementById('meta');
const starBtn = document.getElementById('starBtn');
const showAllBtn = document.getElementById('showAll');
const showStarBtn = document.getElementById('showStar');
const fileInput = document.getElementById('fileInput');
const shuffleBtn = document.getElementById('shuffleBtn');

function getVisibleList() {
  if (filter === 'all') return cards;
  return cards.filter(c => starred.has(c.word));
}

function syncIndex() {
  const list = getVisibleList();
  if (list.length === 0) {
    idx = 0;
    return;
  }
  if (idx >= list.length) idx = 0;
}

function render() {
  const list = getVisibleList();
  if (list.length === 0) {
    wordTop.textContent = 'æ²’æœ‰å¡ç‰‡';
    ipaEl.textContent = '';
    posEl.textContent = '';
    engExample.textContent = '';
    wordCn.textContent = '';
    posCn.textContent = '';
    cnExample.textContent = '';
    metaEl.textContent = 'Card 0 / 0';
    starBtn.classList.remove('active');
    starBtn.textContent = 'â˜†';
    return;
  }
  const c = list[idx];
  wordTop.textContent = c.word;
  ipaEl.textContent = c.ipa || '';
  posEl.textContent = c.pos || '';
  engExample.textContent = c.sentence || '';
  wordCn.textContent = c.meaning || '';
  posCn.textContent = c.pos || '';
  cnExample.textContent = c.sentence_cn || '';
  metaEl.textContent = `Card ${idx + 1} / ${list.length}`;
  if (starred.has(c.word)) {
    starBtn.classList.add('active');
    starBtn.textContent = 'â˜…';
  } else {
    starBtn.classList.remove('active');
    starBtn.textContent = 'â˜†';
  }
}

// é»æ“Šå¡ç‰‡ç¿»é¢ï¼ˆé™¤äº†é»æ˜Ÿè™Ÿå¤–ï¼‰
cardEl.addEventListener('click', () => {
  cardEl.classList.toggle('is-flipped');
});

// é»æ“Šæ˜Ÿè™Ÿåˆ‡æ›æ¨™è¨˜
starBtn.addEventListener('click', (e) => {
  e.stopPropagation(); // é˜»æ­¢å†’æ³¡ï¼Œä¸æœƒç¿»é¢
  const list = getVisibleList();
  if (list.length === 0) return;
  const w = list[idx].word;
  if (starred.has(w)) {
    starred.delete(w);
  } else {
    starred.add(w);
  }
  saveStars();
  render();
});

// ä¸‹ä¸€å¼µ
document.getElementById('next').addEventListener('click', () => {
  cardEl.classList.remove('is-flipped');
  const list = getVisibleList();
  if (list.length === 0) return;
  idx = (idx + 1) % list.length;
  render();
});

// ä¸Šä¸€å¼µ
document.getElementById('prev').addEventListener('click', () => {
  cardEl.classList.remove('is-flipped');
  const list = getVisibleList();
  if (list.length === 0) return;
  idx = (idx - 1 + list.length) % list.length;
  render();
});

// ç¯©é¸å…¨éƒ¨
showAllBtn.addEventListener('click', () => {
  filter = 'all';
  idx = 0;
  showAllBtn.classList.add('active');
  showAllBtn.setAttribute('aria-selected', 'true');
  showStarBtn.classList.remove('active');
  showStarBtn.setAttribute('aria-selected', 'false');
  render();
});

// ç¯©é¸æ¨™è¨˜
showStarBtn.addEventListener('click', () => {
  filter = 'star';
  idx = 0;
  showStarBtn.classList.add('active');
  showStarBtn.setAttribute('aria-selected', 'true');
  showAllBtn.classList.remove('active');
  showAllBtn.setAttribute('aria-selected', 'false');
  render();
});

// éµç›¤æ“ä½œï¼šâ† â†’ ç¿»é ï¼Œç©ºç™½éµç¿»é¢
window.addEventListener('keydown', (e) => {
  if (e.key === 'ArrowRight') document.getElementById('next').click();
  if (e.key === 'ArrowLeft') document.getElementById('prev').click();
  if (e.code === 'Space') {
    e.preventDefault();
    cardEl.click();
  }
});

// æ´—ç‰Œæ¼”ç®—æ³•
function shuffleArray(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

// æ´—ç‰ŒæŒ‰éˆ•äº‹ä»¶
shuffleBtn.addEventListener('click', () => {
  shuffleArray(cards);
  idx = 0;
  render();
  saveCards(); // æ´—ç‰Œå¾Œå­˜èµ·ä¾†
});

// åŒ¯å…¥ txt æª”æ¡ˆï¼ˆæ ¼å¼éœ€èˆ‡ä½ ä¹‹å‰çš„ txt æ ¼å¼é¡ä¼¼ï¼‰
fileInput.addEventListener('change', (e) => {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = (event) => {
    const text = event.target.result;
    parseTxtToCards(text);
    idx = 0;
    filter = 'all';
    showAllBtn.classList.add('active');
    showAllBtn.setAttribute('aria-selected', 'true');
    showStarBtn.classList.remove('active');
    showStarBtn.setAttribute('aria-selected', 'false');
    render();
    saveCards(); // åŒ¯å…¥æˆåŠŸå¾Œå­˜èµ·ä¾†
  };
  reader.readAsText(file, 'utf-8');
  e.target.value = '';
});

// è§£æ txt å…§å®¹è½‰ç‚º cards é™£åˆ—
function parseTxtToCards(txt) {
  // é æœŸæ ¼å¼ç¯„ä¾‹ï¼ˆæ¯çµ„é–“ç©ºè¡Œåˆ†éš”ï¼‰ï¼š
  // rehearsal
  // [ rÉªË‹hÉs! ]
  // åè©
  // æ’ç·´, æ’æ¼”, å½©æ’
  // Do you think the university could help us rent a rehearsal space in a commercial dance studio in town, given the situation?
  // ä½ è¦ºå¾—è€ƒæ…®åˆ°é€™ç¨®ç‹€æ³ï¼Œå­¸æ ¡æœƒå¹«æˆ‘å€‘åœ¨åŸå¸‚ä¸­çš„å•†æ¥­èˆè¹ˆå®¤ï¼Œç§Ÿå€Ÿä¸€å€‹æ’ç·´çš„å ´åœ°ã€‚

  const groups = txt.trim().split(/\n\s*\n/);
  const newCards = [];
  for (const g of groups) {
    const lines = g.trim().split('\n');
    if (lines.length >= 6) {
      newCards.push({
        word: lines[0].trim(),
        ipa: lines[1].trim(),
        pos: lines[2].trim(),
        meaning: lines[3].trim(),
        sentence: lines[4].trim(),
        sentence_cn: lines[5].trim()
      });
    }
  }
  if (newCards.length > 0) {
    cards = newCards;
  } else {
    alert('åŒ¯å…¥æ ¼å¼éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ txt æ ¼å¼');
  }
}

// åˆå§‹åŒ–æ™‚å…ˆå˜—è©¦è®€ localStorage çš„å¡ç‰‡è³‡æ–™
loadCards();
render();

</script>
</body>
</html>
